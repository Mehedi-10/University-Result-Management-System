{% extends 'base3.html' %}
{% load extra %}
{% block title %}{{ 'Before Final result' }}{% endblock %}
{% block style_content %}
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/teacherresult.css' %}">
    <link rel="stylesheet" href="{% static 'css/spreadsheet.css' %}">
    <style>
        #tab {
            border-collapse: collapse;
        }

        #tab td, th {
            border: 2px solid black;
            text-align: center;
            padding: 0;
            margin: 0;
        }

        #tab input:read-only {
            background-color: #E8E9F3 !important;
            color: black;
        }

        #tab input {
            display: block;
            border: none;
            max-width: 100px;
            height: 30px;
            text-align: center;
            font-size: 10pt;
        }

        #tab .hello {
            background-color: #DADFF7 !important;
            color: black;
            padding: 0 !important;
            height: 20px !important;
        }

    </style>
{% endblock %}
{% block icone %}{% endblock %}
{% block content %}
    <div style="text-align: center ;padding-top: 17px; font-size: 19px">
        Comilla University <br>
        Department of Computer Science & Engineering<br>
        Semester: {{ cons.head.semester }} &nbsp;&nbsp; Session: 2018-19<br>
        Course Name: {{ cons.head.course }} <br>
        Course Code: {{ cons.head.course_code }} &nbsp;&nbsp;Full Marks: {{ cons.head.marks }}
        <br>
        Before Final
    </div>
    <hr>



    <div id="hehe" style="height: 67vh; width: max-content;display: block;margin: auto;">

        <form id="po" method="POST" action="">
            {% csrf_token %}
            <table id="tab">
                <tr style="width:100%;">
                    <td style="min-width: 27px"></td>
                    <td class="hello A">A
                    </td>
                    <td id="B" oncontextmenu="myadd1(event)" class="hello B">B

                        <div id="floatB" class="list-group"
                             style="display: none; border: 1px solid #2E1760; border-radius: 0;
">
                            <button type="button" onclick="addcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:1px solid black">
                                Insert
                            </button>
                            <button type="button" onclick="delcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:0">
                                Delete
                            </button>
                        </div>
                    </td>
                    <td id="C" oncontextmenu="myadd1(event)" class="hello C">
                        C
                        <div id="floatC" class="list-group"
                             style="display: none; border: 1px solid #2E1760; border-radius: 0;
">
                            <button type="button" onclick="addcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:1px solid black">
                                Insert
                            </button>
                            <button type="button" onclick="delcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:0">
                                Delete
                            </button>
                        </div>
                    </td>
                    <td id="D" oncontextmenu="myadd1(event)" class="hello D">D
                        <div id="floatD" class="list-group"
                             style="display: none; border: 1px solid #2E1760; border-radius: 0;
">
                            <button type="button" onclick="addcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:1px solid black">
                                Insert
                            </button>
                            <button type="button" onclick="delcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:0">
                                Delete
                            </button>
                        </div>
                    </td>
                    <td id="E" oncontextmenu="myadd1(event)" class="hello E">E
                        <div id="floatE" class="list-group"
                             style="display: none; border: 1px solid #2E1760; border-radius: 0;
">
                            <button type="button" onclick="addcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:1px solid black">
                                Insert
                            </button>
                            <button type="button" onclick="delcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:0">
                                Delete
                            </button>
                        </div>
                    </td>
                    <td id="F" oncontextmenu="myadd1(event)" class="hello F">F
                        <div id="floatF" class="list-group"
                             style="display: none; border: 1px solid #2E1760; border-radius: 0;
">
                            <button type="button" onclick="addcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:1px solid black">
                                Insert
                            </button>
                            <button type="button" onclick="delcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:0">
                                Delete
                            </button>
                        </div>
                    </td>
                    <td id="G" oncontextmenu="myadd1(event)" class="hello G">G
                        <div id="floatG" class="list-group"
                             style="display: none; border: 1px solid #2E1760; border-radius: 0;
">
                            <button type="button" onclick="addcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:1px solid black">
                                Insert
                            </button>
                            <button type="button" onclick="delcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:0">
                                Delete
                            </button>
                        </div>
                    </td>
                    <td id="H" oncontextmenu="myadd1(event)" class="hello H">H
                        <div id="floatH" class="list-group"
                             style="display: none; border: 1px solid #2E1760; border-radius: 0;
">
                            <button type="button" onclick="addcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:1px solid black">
                                Insert
                            </button>
                            <button type="button" onclick="delcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:0">
                                Delete
                            </button>
                        </div>
                    </td>
                    <td id="I" oncontextmenu="myadd1(event)" class="hello I">I
                        <div id="floatI" class="list-group"
                             style="display: none; border: 1px solid #2E1760; border-radius: 0;
">
                            <button type="button" onclick="addcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:1px solid black">
                                Insert
                            </button>
                            <button type="button" onclick="delcol()"
                                    class="btn btn-sm list-group-item list-group-item-action list-group-item-dark"
                                    style="border-radius: 0; border-bottom:0">
                                Delete
                            </button>
                        </div>
                    </td>
                    <td class="hello J">J

                    </td>
                </tr>

                {% for i,val in cons.constt|dicfast %}
                    <tr>
                        <td class="hello">
                            {{ i }}
                        </td>
                        <td>
                            <input id="{{ i }}{{ 'A' }}" name="{{ i }}{{ 'A' }}" class="spreadsheets" type="text"
                                   readonly value="{{ val.Student_id }}"></td>
                        <td><input id="{{ i }}{{ 'B' }}" name="{{ i }}{{ 'B' }}" class="spreadsheets" type="text"
                                   value="{{ val.A }}"></td>
                        <td class="C"><input id="{{ i }}{{ 'C' }}" name="{{ i }}{{ 'C' }}" class="spreadsheets"
                                             type="text"
                                             value="{{ val.B }}"></td>
                        <td class="D"><input id="{{ i }}{{ 'D' }}" name="{{ i }}{{ 'D' }}" class="spreadsheets"
                                             type="text"
                                             value="{{ val.C }}"></td>
                        <td class="E"><input id="{{ i }}{{ 'E' }}" name="{{ i }}{{ 'E' }}" class="spreadsheets"
                                             type="text"
                                             value="{{ val.D }}"></td>
                        <td class="F"><input id="{{ i }}{{ 'F' }}" name="{{ i }}{{ 'F' }}" class="spreadsheets"
                                             type="text"
                                             value="{{ val.E }}"></td>
                        <td class="G"><input id="{{ i }}{{ 'G' }}" name="{{ i }}{{ 'G' }}" class="spreadsheets"
                                             type="text"
                                             value="{{ val.F }}"></td>
                        <td class="H"><input id="{{ i }}{{ 'H' }}" name="{{ i }}{{ 'H' }}" class="spreadsheets"
                                             type="text"
                                             value="{{ val.G }}"></td>
                        <td class="I"><input id="{{ i }}{{ 'I' }}" name="{{ i }}{{ 'I' }}" class="spreadsheets"
                                             type="text"
                                             value="{{ val.H }}"></td>
                        <td class="J"><input id="{{ i }}{{ 'J' }}" name="{{ i }}{{ 'J' }}" class="spreadsheets"
                                             type="text"
                                             value="{{ val.I }}"></td>
                    </tr>

                {% endfor %}
            </table>
        </form>
    </div>

    <div class="row" id="vanish" style="margin: 0px; padding-bottom: 11px;padding-top: 11px;">
        <div class="col" style="padding-left: 100px ;text-align: left">
            <input type="button" id="btn" value="export" onclick="window.print()">
        </div>
        <div class="col" style="padding-right: 100px ;text-align: right">
            <input type="button" id="onceclickable" value="submit">
        </div>
    </div>

{% endblock %}
{% block script %}
    <script>
        const url = "nothing";
        var colmx = 74;
        $('.spreadsheets').keydown(function (e) {
            if (e.which === 13) {
                var x = 1, y = $('.spreadsheets').index(this);
                if (y % 10 === 9)
                    x++;
                var index = $('.spreadsheets').index(this) + x;
                $('.spreadsheets').eq(index).focus();
            }
        });


        const button = document.querySelector('#onceclickable');

        {% if cons.constt|is_blocked %}
            button.disabled = true;
            button.value = "submitted";
            const bu = document.getElementById('hehe')
            for (let i = 0; i < 900; i++) {
                bu.getElementsByClassName('spreadsheets')[i].readOnly = true;

            }
        {% endif %}

        function countString(str, letter) {
            let count = 0;

            for (let i = 0; i < str.length; i++) {
                if (str.charAt(i) === letter) {
                    count += 1;
                }
            }
            return count;
        }

        for (let i = 0; i < 900; i++) {
            for (let j = 65; j < 75; j++) {
                var x = i.toString();
                x += String.fromCharCode(j);
                try {
                    const inp = document.getElementById(x);
                    inp.addEventListener("input", myFunction);
                    if (inp.value === 'None' && x[0] > '0') {
                        inp.value = '';
                    }

                    function myFunction() {
                        var ss = inp.id, sx = inp.value;
                        var ll = sx.length;
                        if (ss[0] !== '0' && (sx[ll - 1] < '0' || sx[ll - 1] > '9')) {
                            if (countString(sx,".")>1) {
                                alert('Oops sorry!!! Please Insert Only Numbers and only a Radix point at cell' + ss);
                                sx = sx.slice(0, -1);
                            }
                        }
                        inp.value = sx;
                         var aaacellvalue = {};
                        for (let k = 65; k < 75; k++) {
                            try {
                                cell = inp.id;
                                cellid = cell.slice(0, -1) + String.fromCharCode(k);
                                aaacellvalue[cellid] = document.getElementById(cellid).value;
                            } catch (e) {
                            }
                        }

                        $.ajax({
                            type: "POST",
                            url: url,
                            data:
                                {
                                    aaacellvalue,
                                    csrfmiddlewaretoken: '{{ csrf_token }}'
                                }
                        });
                    }

                } catch (e) {

                }
            }
        }

        const disableButton = () => {
            document.getElementById('po').submit();
            button.disabled = true;
            button.value = "submitted";
            const bu = document.getElementById('hehe')
            for (let i = 0; i < 900; i++) {
                bu.getElementsByClassName('spreadsheets')[i].readOnly = true;

            }
        };
        button.addEventListener('click', disableButton);


        window.addEventListener('contextmenu', function (e) {
            e.preventDefault();
        }, false);

        window.addEventListener('click', function (e) {
            for (let i = 66; i < 75; i++) {
                var hideid = "float" + String.fromCharCode(i);
                try {
                    document.getElementById(hideid).style.display = 'none';
                } catch (e) {

                }

            }
            e.preventDefault();
        }, false);

        var operationid, curcolnum;

        function notempty() {
            curcolnum = colmx;
            while (curcolnum > 65) {
                var tmp = '0' + String.fromCharCode(curcolnum);
                var hi = document.getElementById(tmp);
                if (hi.value !== 'None' && hi.value !== '')
                    break;
                curcolnum--;
            }
        }

        window.onload = function () {
            notempty();
            for (let i = curcolnum + 1; i < colmx + 1; i++) {
                var hid = '.';
                hid += String.fromCharCode(i);
                var willhide = document.querySelectorAll(hid);
                for (let j = 0; j < 90; j++) {
                    try {
                        willhide[j].style.display = "none";
                    } catch (e) {

                    }
                }
            }
        }


        function addcol() {
            notempty();
            if (curcolnum !== colmx) {
                var hiden = '.' + String.fromCharCode(curcolnum + 1);
                var show = document.querySelectorAll(hiden);
                for (let i = 0; i < 90; i++) {
                    try {
                        show[i].style.display = 'table-cell';
                    } catch (e) {
                    }
                }
                console.log(curcolnum + 1);
                console.log(operationid);
                var lim = operationid.charCodeAt(0);
                for (let i = curcolnum + 1; i > lim; i--) {
                    var dest = String.fromCharCode(i);
                    var sourc = String.fromCharCode(i - 1);
                    for (let j = 0; j < 90; j++) {
                        try {
                            console.log(j.toString() + dest);
                            document.getElementById(j.toString() + dest).value = document.getElementById(j.toString() + sourc).value;
                            if (sourc === operationid) {
                                document.getElementById(j.toString() + sourc).value = '';
                            }
                        } catch (e) {

                        }
                    }
                }
                sendall();

            } else {
                alert('can\'t add more');
            }
        }

        function delcol() {
            notempty();
            if (curcolnum !== 66) {
                var lim = operationid.charCodeAt(0);

                for (let i = lim; i < curcolnum; i++) {
                    var dest = String.fromCharCode(i);
                    var sourc = String.fromCharCode(i + 1);
                    for (let j = 0; j < 90; j++) {
                        try {
                            console.log(j.toString() + dest);
                            document.getElementById(j.toString() + dest).value = document.getElementById(j.toString() + sourc).value;
                            if (sourc.charCodeAt(0) === curcolnum) {
                                document.getElementById(j.toString() + sourc).value = '';
                            }
                        } catch (e) {

                        }
                    }
                    var hiden = '.' + String.fromCharCode(curcolnum);
                    console.log(hiden);
                    var hidenow = document.querySelectorAll(hiden);
                    for (let i = 0; i < 90; i++) {
                        try {
                            hidenow[i].style.display = 'none';
                        } catch (e) {
                        }
                    }
                }
                sendall();

            } else {
                alert('can\'t detete');
            }
        }


        function myadd1(event) {
            var ch = event.target.id;
            operationid = ch;
            var idis = "float" + ch;
            addid = ch.charCodeAt(0);
            const adddel = document.getElementById(idis);
            adddel.style.display = 'block';
            adddel.style.position = 'absolute';
            for (let i = 66; i < 75; i++) {
                if (String.fromCharCode(i) !== ch) {
                    var hideid = "float" + String.fromCharCode(i);
                    try {
                        document.getElementById(hideid).style.display = 'none';
                    } catch (e) {

                    }
                }
            }

        }

        function sendall() {
            for (let i = 0; i < 90; i++) {
                var aaacellvalue = {};
                var possible = 0;
                for (let k = 65; k < 75; k++) {
                    try {
                        cellid = i.toString() + String.fromCharCode(k);
                        console.log(cellid);
                        console.log(document.getElementById(cellid).value);
                        aaacellvalue[cellid] = document.getElementById(cellid).value;
                        if (aaacellvalue[cellid] === '')
                            aaacellvalue[cellid] = 'None';

                    } catch (e) {
                        possible = 1;
                    }
                }
                if (possible === 0) {
                    $.ajax({
                        type: "POST",
                        url: url,
                        data:
                            {
                                aaacellvalue,
                                csrfmiddlewaretoken: '{{ csrf_token }}'
                            }
                    });
                }


            }
        }
    </script>
{% endblock %}
